name: Playwright Tests
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  # schedule:
  #   - cron: '* * * * *'
  #? minute - hour - day - month - day of week
jobs:
  build_dockerimage:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - name: Build Image from Dockerfile
      run: docker build -t playwright-tests-image .
    - name: Save Image as tar
      run: docker save playwright-tests-image -o image.tar
    - uses: actions/upload-artifact@v4
      with:
        name: image-tar
        path: image.tar

  test_playwright:
    runs-on: ubuntu-latest
    needs: build_dockerimage
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: image-tar
          path: .
      - name: Load Image
        run: docker load -i image.tar
      - name: Run Tests inside Container
        run: docker run --rm -w /app -v "$PWD/playwright-report:/app/playwright-report" playwright-tests-image npx playwright test --project=chromium --reporter=line,html
      - name: Upload Report Artifacts
        if: always()
      - uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: playwright-report/
          retention-days: 30
